\copy (SELECT title, id_order, id, job_name, progress, extperf.first_published_at first_published_at_utc, created_at created_at_utc, started_at started_at_utc, updated_at updated_at_utc, completed_at completed_at_utc, extract (epoch from (completed_at::timestamp - started_at::timestamp))::integer runtime_sec, finish_code, priority, backgrounder_id, bkjbs.new_extract_id, extperf.datasources_size, extperf.extract_size, extperf.db_class, extperf.state, extperf.owner_type FROM (SELECT id, title, job_name, progress, updated_at, created_at, completed_at, started_at, finish_code, priority, backgrounder_id, serial_collection_id, luid, creator_id, substring(regexp_replace(notes, '^.*{', ''), 1, 36) new_extract_id, row_number() over (partition by title order by started_at desc) id_order FROM background_jobs WHERE substring(title, 1, 2) = 'DS') bkjbs LEFT JOIN (SELECT extracts.id as extract_id, substring(descriptor, 2, length(descriptor) - 2) new_extract_id, extracts.datasource_id, extracts.size extract_size, datasources.name, datasources.project_id, datasources.size datasources_size, datasources.state, datasources.db_class, datasources.first_published_at, datasources.luid, datasources.tds_luid, _datasources.owner_type FROM extracts LEFT JOIN datasources ON extracts.datasource_id = datasources.id LEFT JOIN _datasources ON datasources.id = _datasources.id) extperf ON bkjbs.new_extract_id = extperf.new_extract_id WHERE substring(title, 1, 2) = 'DS') to '/home/tableau_srv/scripts/extract_timings_export.csv' NULL AS '' DELIMITER AS '|';
